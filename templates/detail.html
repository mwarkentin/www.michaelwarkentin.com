{% from "_macros.html" import render_size_option %}

{% extends "base.html" %}

{% block content %}
    <div class="page-header">
        <button class="btn btn-large btn-success pull-right js-btn-buy">Buy this print</button>
        <h1>{{ piece.title }} <small>{{ piece.created.strftime('%B %d, %Y') }}</small></h1>
    </div>

    <form action="/charge" method="POST" class="hide" id="BuyPiece">
        <fieldset>
            <div class="controls controls-row">
                <select name="size" id="CanvasSize" class="span3">
                    {% for size in available_sizes %}
                        {{ render_size_option(size) }}
                    {% endfor %}
                </select>
                <input type="tel" name="phone" placeholder="Phone number" class="span2">
                <input type="email" name="email" placeholder="Email address" class="span3">
            </div>
        </fieldset>
        <input type="hidden" name="piece" value="{{ piece.id }}">

        <div class="form-actions">
            <script src="https://button.stripe.com/v1/button.js" class="stripe-button"
                data-key="{{ stripe_key }}"
                data-description="{{ piece.title }}"
                data-address></script>
        </div>
    </form>

    <div id="DetailsCarousel" class="carousel slide" data-interval="5000">
        <div class="carousel-inner">
            <div class="item active">
                <img src="{{ piece.url }}" alt="{{ piece.title }}">
            </div>
            {% for image in piece.images %}
            <div class="item">
                <img src="{{ image.url }}" alt="{{ image.title }}">
            </div>
            {% endfor %}
        </div>
        <a class="carousel-control left" href="#DetailsCarousel" data-slide="prev">&lsaquo;</a>
        <a class="carousel-control right" href="#DetailsCarousel" data-slide="next">&rsaquo;</a>
    </div>
{% endblock %}

{% block extra_js %}
<script type="text/javascript">
$(function(){
    $('.carousel').carousel();
    $('.js-btn-buy').on('click', function(e) {
        var $form = $('#BuyPiece'),
            $btn = $(e.target);

        $form.slideToggle();
        $btn
            .toggleClass('btn-success')
            .text($btn.text() == 'Buy this print' ? 'Cancel' : 'Buy this print');
    });
});
</script>
{% endblock %}
